{% extends "base.html" %}
{% from 'base.html' import sport_icon_file %}
{% block title %}{{ item.title }} – sponpon{% endblock %}

{% block content %}

{# ---- one source of truth for the video url (for gallery thumb) ---- #}
{% set yt_fallback = 'https://www.youtube.com/watch?v=fTvPYdKZqO0' %}

{# default video podľa klubu (tu: HKM Nová Dubnica) #}
{% set yt_default_by_slug = {
  'hkm-nova-dubnica': 'https://www.youtube.com/watch?v=fTvPYdKZqO0'
} %}

{# výsledná URL – preferuj item.video_url, potom klubový default, inak fallback #}
{% set yt_url = (
  item.video_url if item is defined and item.video_url is defined and item.video_url
  else yt_default_by_slug.get(item.slug, yt_fallback)
) %}

{# či zobrazovať video thumb (pravda, ak je v iteme alebo máme klubový default) #}
{% set has_video = (
  (item is defined and item.video_url is defined and item.video_url) or yt_default_by_slug.get(item.slug)
) %}

<!-- ===================== BREADCRUMB ===================== -->
<nav class="ld-breadcrumb">
  <div class="container">
    <ol class="bc-list">
      <li><a href="{{ url_for('index') }}">Marketplace</a></li>
      <li><a href="#">Kluby</a></li>
      <li aria-current="page">{{ item.title }}</li>
    </ol>
  </div>
</nav>

<!-- ===================== HERO ===================== -->
<section class="ld-hero">
  <div class="container">
    <div class="row g-3 align-items-center">
      <div class="col-xl-8">
        <div class="d-flex align-items-start gap-3">
          <img class="ld-avatar" src="{{ url_for('static', filename=item.avatar) }}" alt="{{ item.title }}">
          <div class="flex-grow-1">
            <div class="d-flex align-items-center gap-2 flex-wrap">
              <h1 class="ld-title mb-0">{{ item.title }}</h1>
              {% if item.verified %}<i class="bi bi-patch-check-fill sp-verified" title="Overené"></i>{% endif %}
            </div>
            <div class="ld-meta text-secondary mt-1 d-flex align-items-center gap-2 flex-wrap">
              <span class="me-2"><i class="bi bi-geo-alt"></i> {{ item.location }}</span>
              <span class="sp-tag">
                <img src="{{ url_for('static', filename='icons/' ~ sport_icon_file(item.sport)) }}" class="icon-16" alt="">
                {{ item.sport }}
              </span>
            </div>
            <div class="ld-meta ld-metrics text-secondary mt-2 d-flex align-items-center gap-2 flex-wrap">
              <span class="sp-stat-chip small"><i class="bi bi-people"></i> Dosah {{ item.reach }}</span>
              <span class="sp-stat-chip small"><i class="bi bi-emoji-smile"></i> ER {{ '%.1f'|format(item.er) }}%</span>
              <span class="sp-stat-chip small"><i class="bi bi-cash-coin"></i> od €{{ item.price_from }}</span>
              {% if item.metrics and item.metrics.avg_cpm %}
                <span class="sp-stat-chip small"><i class="bi bi-bar-chart"></i> CPM {{ item.metrics.avg_cpm }}</span>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Socials (zobraz iba siete, ktoré majú link) -->
      <div class="col-xl-4">
        {% set S = item.social or {} %}
        <div class="ld-seg d-flex justify-content-xl-end flex-wrap">
          {% if item.website %}
            <a class="seg-btn"
               href="{{ item.website if item.website.startswith('http') else 'https://' ~ item.website }}"
               target="_blank" rel="noopener noreferrer nofollow" aria-label="Web">
              <i class="bi bi-globe2"></i>
            </a>
          {% endif %}
          {% if S.instagram %}
            <a class="seg-btn" href="{{ S.instagram }}" target="_blank" rel="noopener noreferrer nofollow" aria-label="Instagram">
              <i class="bi bi-instagram"></i>
            </a>
          {% endif %}
          {% if S.facebook %}
            <a class="seg-btn" href="{{ S.facebook }}" target="_blank" rel="noopener noreferrer nofollow" aria-label="Facebook">
              <i class="bi bi-facebook"></i>
            </a>
          {% endif %}
          {% if S.youtube %}
            <a class="seg-btn" href="{{ S.youtube }}" target="_blank" rel="noopener noreferrer nofollow" aria-label="YouTube">
              <i class="bi bi-youtube"></i>
            </a>
          {% endif %}
          {% if S.twitch %}
            <a class="seg-btn" href="{{ S.twitch }}" target="_blank" rel="noopener noreferrer nofollow" aria-label="Twitch">
              <i class="bi bi-twitch"></i>
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ======= MOBILE QUICK NAV (for easier navigation on phones) ======= -->
<div class="container d-lg-none">
  <div class="ld-mobile-nav">
    <button class="mnav" data-scroll="#season"><i class="bi bi-collection"></i> Balíčky</button>
    <button class="mnav" data-scroll="#events"><i class="bi bi-calendar-event"></i> Eventy</button>
    <button class="mnav" data-scroll="#projects"><i class="bi bi-tools"></i> Projekty</button>
  </div>
</div>

<!-- ===================== BODY ===================== -->
<section class="py-3">
  <div class="container">
    <div class="row g-4">
      <!-- LEFT -->
      <div class="col-lg-8">

        <!-- Cover (always cover.png) -->
        <div class="card rounded-4 overflow-hidden ld-card mb-3">
          <div class="ratio ratio-16x9 ld-main-img-wrap" id="ldMainWrap" data-yt="{{ yt_url }}">
            <img id="ldMain" src="{{ url_for('static', filename='covers/cover.png') }}" class="ld-main-img object-fit-cover" alt="cover {{ item.title }}">
            <div class="sport-pill">
              <img src="{{ url_for('static', filename='icons/' ~ sport_icon_file(item.sport)) }}" class="icon-16" alt="">
              {{ item.sport }}
            </div>
            <div class="ld-grad"></div>
          </div>
        </div>

        {# Pomocné cesty #}
        {% set COVER1 = url_for('static', filename='covers/cover.png') %}
        {% set COVER2 = url_for('static', filename='covers/cover2.png') %}
        {% set COVER3 = url_for('static', filename='covers/cover3.png') %}
        {% set COVER4 = url_for('static', filename='covers/cover4.png') %}

        <!-- Thumbnails (drag/swipe scroll; žiadne overlay/šípky) -->
        <div class="card rounded-4 ld-card p-2 mb-4">
          <div class="ld-thumbs-row">

            {# 1) cover2 #}
            <button type="button" class="ld-thumb" data-src="{{ COVER2 }}">
              <img src="{{ COVER2 }}" alt="thumb cover2">
            </button>

            {# 2) VIDEO #}
            {% if has_video %}
              <button type="button" class="ld-thumb ld-thumb-video" data-video="{{ yt_url }}">
                <img src="{{ COVER1 }}" alt="video thumb">
                <span class="yt-badge"><i class="bi bi-play-fill"></i></span>
              </button>
            {% endif %}

            {# 3) cover3 #}
            <button type="button" class="ld-thumb" data-src="{{ COVER3 }}">
              <img src="{{ COVER3 }}" alt="thumb cover3">
            </button>

            {# 4) cover4 #}
            <button type="button" class="ld-thumb" data-src="{{ COVER4 }}">
              <img src="{{ COVER4 }}" alt="thumb cover4">
            </button>

            {# 5) cover1 default #}
            <button type="button" class="ld-thumb is-active" data-src="{{ COVER1 }}">
              <img src="{{ COVER1 }}" alt="thumb cover (default)">
            </button>
          </div>
        </div>


        <!-- PREHĽAD -->
        <div id="overview" class="card rounded-4 p-3 p-md-4 ld-card mb-4">
          <h2 class="h5 mb-2">Prehľad</h2>
          <p class="ld-overview-text text-secondary mb-0">
            {{ item.title }} je regionálny klub so silnou komunitou a aktívnou mládežou. Pôsobí v lokalite {{ item.location }} a venuje sa športu {{ item.sport }} s dôrazom na dlhodobý rozvoj hráčov aj fanúšikov. Pre partnerov prináša transparentnú spoluprácu, kvalitný obsah a merateľný lokálny dosah.
            <a href="#more-stats" class="link-plain">Zobraziť štatistiky</a>
          </p>

          <!-- Významné úspechy -->
          <div class="mt-3 d-flex align-items-center justify-content-between flex-wrap gap-2 ach-head">
            <h3 class="h6 mb-0">Významné úspechy</h3>
            <button id="achToggle" class="btn btn-ghost btn-slim ach-more-btn fw-normal">
              Zobraziť viac
            </button>
          </div>
          <div id="achList" class="mt-2">
            <div class="row g-2">
              <div class="col-md-6">
                <div class="ach-pill">
                  <img class="ach-logo" src="{{ url_for('static', filename='achievements/logo1.png') }}" alt="logo">
                  Majster 1. ligy – 2021/22
                </div>
              </div>
              <div class="col-md-6">
                <div class="ach-pill">
                  <img class="ach-logo" src="{{ url_for('static', filename='achievements/logo2.png') }}" alt="logo">
                  Postup do extraligy – 2022/23
                </div>
              </div>
              <div class="col-md-6">
                <div class="ach-pill">
                  <img class="ach-logo" src="{{ url_for('static', filename='achievements/logo1.png') }}" alt="logo">
                  Víťaz Memoriál J. Mráza – 2023
                </div>
              </div>
              <div class="col-md-6">
                <div class="ach-pill">
                  <img class="ach-logo" src="{{ url_for('static', filename='achievements/logo2.png') }}" alt="logo">
                  Top 8 Slovenský pohár – 2024
                </div>
              </div>
              <div class="col-md-6 extra-ach d-none">
                <div class="ach-pill">
                  <img class="ach-logo" src="{{ url_for('static', filename='achievements/logo1.png') }}" alt="logo">
                  Najlepší mládežnícky program – 2024
                </div>
              </div>
              <div class="col-md-6 extra-ach d-none">
                <div class="ach-pill">
                  <img class="ach-logo" src="{{ url_for('static', filename='achievements/logo2.png') }}" alt="logo">
                  Rekordná sezóna ER – 3.9%
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== SEZÓNA ========== -->
        <div id="season" class="card rounded-4 p-3 p-md-4 ld-card mb-4">
          <div class="d-flex align-items-center justify-content-between mb-2 season-head">
            <h2 class="h5 mb-0 season-title">Sponzoring na sezónu</h2>
            <span class="text-secondary small season-sub">Vyber balík alebo kombinuj inventár</span>
          </div>

          {% if item.inventory %}
          <div class="ld-inv-block mb-3">
            <div class="text-secondary small mb-1">Ponuka</div>
            <div class="ld-inv-grid" id="invGrid">
              {% for group, items in item.inventory.items() %}
                {% for it in items %}
                  <span class="inv-chip small" data-inv="{{ it.name }}"><i class="bi {{ it.icon }}"></i> {{ it.name }}</span>
                {% endfor %}
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <div class="row g-3">
            {% for p in item.packages|default([]) %}
            <div class="col-12 col-md-6">
              <div class="ld-pack h-100">
                <div class="ld-pack-head">
                  <div class="ld-pack-name">{{ p.name }}</div>
                  <div class="ld-price">{{ p.price }}</div>
                </div>
                <ul class="ld-pack-list">
                  {% for inc in p.incl %}<li>{{ inc }}</li>{% endfor %}
                </ul>
                <div class="ld-actions mt-2">
                  <button class="btn btn-outline-brand btn-compact"
                          data-cta="add"
                          data-kind="{{ kind }}"
                          data-slug="{{ item.slug }}"
                          data-label="{{ item.title }} – {{ p.name }}"
                          data-price="{{ p.price }}"
                          data-cover="{{ url_for('static', filename='covers/cover.png') }}">
                    <i class="bi bi-plus-circle"></i> Pridať do portfólia
                  </button>
                </div>
              </div>
            </div>
            {% else %}
            <div class="col-12">
              <div class="text-secondary small">Zatiaľ bez definovaných balíkov – vyžiadaj ponuku na mieru.</div>
            </div>
            {% endfor %}

            {# ---- Kombinuj ponuku tile (gradient like screenshot) ---- #}
            <div class="col-12 col-md-6">
              <div class="ld-pack h-100 ld-pack--combo">
                <div class="ld-pack-head">
                  <div class="ld-pack-name">Kombinuj ponuku</div>
                  <div class="ld-price">od €{{ item.price_from }}</div>
                </div>
                <ul class="ld-pack-list">
                  <li>Naklikaj položky z ponuky a vytvor si vlastný balík.</li>
                </ul>
                <div class="ld-actions mt-2">
                  <button id="openCombo" class="btn btn-outline-brand btn-compact">
                    <i class="bi bi-sliders"></i> Vybrať
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

<!-- ========== PROJEKTY ========== -->
<div id="projects" class="card rounded-4 p-3 p-md-4 ld-card mb-4">
  <h2 class="h5 mb-3">Projekty klubu</h2>

  <div class="row g-3">
    {% for p in item.projects|default([]) %}
    <div class="col-12">
      <div class="ld-proj">
        <div class="ld-proj-media">
          <img src="{{ url_for('static', filename='covers/cover.png') }}" alt="{{ p.title }}">
        </div>
        <div class="ld-proj-body">
          <div class="d-flex align-items-start justify-content-between gap-2">
            <div>
              <div class="ld-proj-title">{{ p.title }}</div>
              <div class="text-secondary small mb-2">{{ p.desc }}</div>
              {% if p.tags %}
              <div class="d-flex flex-wrap gap-2 mb-2">
                {% for t in p.tags %}<span class="sp-tag small">{{ t }}</span>{% endfor %}
              </div>
              {% endif %}
            </div>
            {% if p.budget %}
            <div class="ld-price">{{ p.budget }}</div>
            {% endif %}
          </div>
          <div class="ld-actions">
            <button class="btn btn-outline-brand btn-compact"
                    data-cta="add"
                    data-kind="{{ kind }}"
                    data-slug="{{ item.slug }}"
                    data-label="{{ item.title }} – projekt: {{ p.title }}"
                    data-price="{{ p.budget|default('') }}"
                    data-cover="{{ url_for('static', filename='covers/cover.png') }}">
              <i class="bi bi-plus-circle"></i> Pridať do portfólia
            </button>
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12">
      <div class="ld-proj">
        <div class="ld-proj-media">
          <img src="{{ url_for('static', filename='covers/cover.png') }}" alt="Projekt klubu">
        </div>
        <div class="ld-proj-body">
          <!-- header row: title + price in one line -->
          <div class="ld-proj-head d-flex align-items-start justify-content-between gap-2">
            <div class="ld-proj-title">Nové dresy – mládež U15</div>
            <div class="ld-price">€2 500</div>
          </div>

          <!-- description now its own block so it can go full width on mobile -->
          <div class="ld-proj-desc text-secondary small mb-2">
            Kompletná sada domácich/hostujúcich dresov pre mládežnícke tímy vrátane trenérok. Branding na rukáve a social vďaka.
          </div>

          <div class="ld-proj-tags d-flex flex-wrap gap-2 mb-2">
            <span class="sp-tag small">Logo na drese</span>
            <span class="sp-tag small">Logo na sociálnych sieťach</span>
          </div>

          <div class="ld-actions">
            <button class="btn btn-outline-brand btn-compact"
                    data-cta="add"
                    data-kind="{{ kind }}"
                    data-slug="{{ item.slug }}"
                    data-label="{{ item.title }} – projekt: Nové dresy U15"
                    data-price="2500"
                    data-cover="{{ url_for('static', filename='covers/cover.png') }}">
              <i class="bi bi-plus-circle"></i> Pridať do portfólia
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

        <!-- ========== EVENTY ========== -->
        {% set key_events = item.key_events|default([
          {'date':'2025-11-20','title':'Derby zápas vs. Spartak','type':'Zápas'},
          {'date':'2026-01-05','title':'Zápas pod holým nebom','type':'Špeciálny event'}
        ]) %}

        <div id="events" class="card rounded-4 p-3 p-md-4 ld-card mb-4">
          <div class="events-head d-flex align-items-center justify-content-between">
            <h2 class="h5 mb-0">Najbližšie eventy</h2>
            <button id="allToggle" class="btn btn-ghost btn-slim">
              <i class="bi bi-list-ul"></i>
              <span class="lab-long">Zobraziť všetky zápasy</span>
              <span class="lab-short">Všetky zápasy</span>
            </button>
          </div>

          <div class="ld-timeline mt-3">
            {% for u in item.upcoming|default([]) %}
            {% set ds = u.date or '' %}
            {% set dday = ds[8:10] %}
            {% set dmon = ds[5:7] %}
            <div class="ld-tl-row">
              <div class="ld-datepill">
                <div class="ld-day">{{ dday }}</div>
                <div class="ld-month">{{ dmon }}</div>
              </div>
              <div class="ld-tl-card flex-grow-1">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                  <div class="me-2">
                    <div class="fw-semibold">{{ u.title }}</div>
                    <div class="text-secondary small"><i class="bi bi-calendar-event"></i> {{ u.date }} • {{ u.type }}</div>
                  </div>

                  <div class="ld-actions">
                    <button class="btn btn-outline-brand btn-compact"
                            data-cta="add"
                            data-kind="{{ kind }}"
                            data-slug="{{ item.slug }}"
                            data-label="{{ item.title }} – {{ u.title }}"
                            data-price=""
                            data-cover="{{ url_for('static', filename='covers/cover.png') }}">
                      <i class="bi bi-plus-circle"></i> Pridať do portfólia
                    </button>
                  </div>
                </div>
              </div>
            </div>
            {% else %}
            <div class="text-secondary small">Zatiaľ bez zverejnených termínov.</div>
            {% endfor %}
          </div>

          <!-- Skryté: všetky zápasy (upcoming + key) -->
          {% set all_events = (item.upcoming|default([]) + key_events) %}
          <div id="allEvents" class="ld-timeline mt-3 d-none">
            {% for u in all_events %}
            {% set ds = u.date or '' %}
            {% set dday = ds[8:10] %}
            {% set dmon = ds[5:7] %}
            <div class="ld-tl-row">
              <div class="ld-datepill">
                <div class="ld-day">{{ dday }}</div>
                <div class="ld-month">{{ dmon }}</div>
              </div>
              <div class="ld-tl-card flex-grow-1">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                  <div class="me-2">
                    <div class="fw-semibold">
                      {{ u.title }}
                      {% if loop.index > (item.upcoming|length|default(0)) %}
                        <span class="ld-key-tag">TOP</span>
                      {% endif %}
                    </div>
                    <div class="text-secondary small"><i class="bi bi-calendar-event"></i> {{ u.date }} • {{ u.type }}</div>
                  </div>
                  <div class="ld-actions">
                    <button class="btn btn-outline-brand btn-compact"
                            data-cta="add"
                            data-kind="{{ kind }}"
                            data-slug="{{ item.slug }}"
                            data-label="{{ item.title }} – {{ u.title }}"
                            data-price=""
                            data-cover="{{ url_for('static', filename='covers/cover.png') }}">
                      <i class="bi bi-plus-circle"></i> Pridať do portfólia
                    </button>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>

          <!-- Najvýznamnejšie eventy sezóny (TOP) -->
          <h3 class="h6 mt-4 mb-2">Najvýznamnejšie eventy sezóny</h3>
          <div class="ld-timeline">
            {% for u in key_events %}
            {% set ds = u.date or '' %}
            {% set dday = ds[8:10] %}
            {% set dmon = ds[5:7] %}
            <div class="ld-tl-row">
              <div class="ld-datepill">
                <div class="ld-day">{{ dday }}</div>
                <div class="ld-month">{{ dmon }}</div>
              </div>
              <div class="ld-tl-card flex-grow-1">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                  <div class="me-2">
                    <div class="fw-semibold">{{ u.title }} <span class="ld-key-tag">TOP</span></div>
                    <div class="text-secondary small"><i class="bi bi-calendar-event"></i> {{ u.date }} • {{ u.type }}</div>
                  </div>
                  <div class="ld-actions">
                    <button class="btn btn-outline-brand btn-compact"
                            data-cta="add"
                            data-kind="{{ kind }}"
                            data-slug="{{ item.slug }}"
                            data-label="{{ item.title }} – {{ u.title }}"
                            data-price=""
                            data-cover="{{ url_for('static', filename='covers/cover.png') }}">
                      <i class="bi bi-plus-circle"></i> Pridať do portfólia
                    </button>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>

          <!-- Mini kalendár -->
          <div id="calendar" class="ld-cal mt-3"
               data-events='{{ (item.upcoming|default([]) + key_events)|tojson }}'>
            <div class="ld-cal-head">
              <button class="cal-nav" data-dir="-1"><i class="bi bi-chevron-left"></i></button>
              <div class="ld-cal-title">Kalendár</div>
              <button class="cal-nav" data-dir="1"><i class="bi bi-chevron-right"></i></button>
            </div>
            <div class="ld-cal-grid">
              <div class="wday">Po</div><div class="wday">Ut</div><div class="wday">St</div><div class="wday">Št</div><div class="wday">Pi</div><div class="wday">So</div><div class="wday">Ne</div>
            </div>
          </div>
        </div>
        <!-- ========== EXTRA: Ďalšie dôležité štatistiky ========== -->
        <div id="more-stats" class="card rounded-4 p-3 p-md-4 ld-card mb-4">
          <h2 class="h5 mb-3">Ďalšie dôležité štatistiky</h2>
          <div class="ld-statgrid">
            <div class="stat"><span class="label">Zápasy / rok</span><span class="val">28</span></div>
            <div class="stat"><span class="label">Domáce zápasy</span><span class="val">14</span></div>
            <div class="stat"><span class="label">Ø návštevnosť štadióna</span><span class="val">1 800</span></div>
            <div class="stat"><span class="label">Predané permanentky</span><span class="val">650</span></div>
            <div class="stat"><span class="label">Členovia mládeže</span><span class="val">220</span></div>
            <div class="stat"><span class="label">Počet trénerov</span><span class="val">18</span></div>
            <div class="stat"><span class="label">Streamy / mesiac</span><span class="val">4</span></div>
            <div class="stat"><span class="label">Ø video views</span><span class="val">25k</span></div>
            <div class="stat"><span class="label">Web návštevnosť / mes.</span><span class="val">18k</span></div>
          </div>
        </div>

        <!-- ========== PUBLIKUM ========== -->
        <div id="audience" class="card rounded-4 p-3 p-md-4 ld-card mb-4">
          <h2 class="h5 mb-3">Publikum</h2>
          <div class="row g-3 align-items-start">
            <div class="col-md-4">
              <div class="ld-aud-box">
                <div class="text-secondary small mb-2">Pohlavie</div>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <span class="aud-chip"><i class="bi bi-gender-female"></i> {{ (item.audience.female if item.audience and item.audience.female is defined else 38) }}%</span>
                  <span class="aud-chip"><i class="bi bi-gender-male"></i> {{ (item.audience.male if item.audience and item.audience.male is defined else 62) }}%</span>
                </div>
              </div>
            </div>
            <div class="col-md-8">
              <div class="ld-aud-ages">
                <div class="text-secondary small mb-2">Vekové skupiny</div>
                {% set ages = (item.audience.age if item.audience and item.audience.age is defined else {'13–17':12,'18–24':28,'25–34':34,'35–44':16,'45+':10}) %}
                {% for label, val in ages.items() %}
                  <div class="ld-age-row">
                    <div class="ld-age-label">{{ label }}</div>
                    <div class="ld-age-bar">
                      <div class="ld-age-fill" style="width: {{ val }}%"><span>{{ val }}%</span></div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- RIGHT (SIDEBAR) -->
      <div class="col-lg-4">
        <div class="ld-side card rounded-4 p-3 p-md-4 sticky-md-top">
          <div class="d-flex align-items-center gap-2 mb-2">
            <img class="ld-side-avatar" src="{{ url_for('static', filename=item.avatar) }}" alt="{{ item.title }}">
            <div>
              <div class="fw-semibold">{{ item.title }}</div>
              <div class="text-secondary small"><i class="bi bi-geo-alt"></i> {{ item.location }}</div>
            </div>
          </div>

          <div class="ld-side-facts my-3 small">
            <div class="d-flex justify-content-between">
              <span class="text-secondary">Ceny od</span><span class="fw-semibold">€{{ item.price_from }}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="text-secondary">Dosah</span><span class="fw-semibold">{{ item.reach }}</span>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-secondary">ER
                <span class="mini-i" data-tip="Engagement Rate – priemerný podiel interakcií (lajky, komentáre, zdieľania) na dosahu za posledné obdobie."></span>
              </span>
              <span class="fw-semibold">{{ '%.1f'|format(item.er) }}%</span>
            </div>
            {% if item.metrics and item.metrics.avg_cpm %}
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-secondary">CPM
                <span class="mini-i" data-tip="Cost per Mille – cena za 1000 zobrazení. Pomáha porovnávať efektivitu naprieč ponukami."></span>
              </span>
              <span class="fw-semibold">{{ item.metrics.avg_cpm }}</span>
            </div>
            {% endif %}
          </div>

          {% if item.metrics %}
          <div class="ld-mini-metrics">
            <div class="ld-mm"><span class="text-secondary small">Posty/mes</span><div class="fw-semibold">{{ item.metrics.posts_m }}</div></div>
            <div class="ld-mm"><span class="text-secondary small">Ø videní</span><div class="fw-semibold">{{ item.metrics.avg_views }}</div></div>
            <div class="ld-mm"><span class="text-secondary small">Zápasy</span><div class="fw-semibold">{{ item.metrics.games|default(28) }}</div></div>
          </div>
          {% endif %}



          {% if item.inventory %}
          <div class="mt-3">
            <div class="text-secondary small mb-1">Ponuka</div>
            <div class="d-flex flex-wrap gap-2">
              {% for group, items in item.inventory.items() %}
                {% for it in items %}
                  <span class="sp-tag small">{{ it.name }}</span>
                {% endfor %}
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <hr class="my-3">
          <div class="d-grid gap-2">
            <a class="btn btn-outline-brand btn-compact" data-scroll="#season"><i class="bi bi-collection"></i> Sezónne balíčky</a>
            <a class="btn btn-ghost btn-compact" data-scroll="#events"><i class="bi bi-calendar-event"></i> Eventy & kalendár</a>
            <a class="btn btn-ghost btn-compact" data-scroll="#projects"><i class="bi bi-tools"></i> Projekty klubu</a>
          </div>

          <div class="mt-3 small">
            {% if item.website %}
              <div class="d-flex align-items-center gap-2 mb-1"><i class="bi bi-globe2"></i> <a href="{{ item.website }}" class="link-underline">{{ item.website }}</a></div>
            {% endif %}
            {% if item.address %}
              <div class="d-flex align-items-center gap-2"><i class="bi bi-geo"></i> <span>{{ item.address }}</span></div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ========= EVENT/ITEM MODAL (light) ========= -->
<div id="calModal" class="sp-modal" aria-hidden="true">
  <div class="sp-modal__backdrop"></div>
  <div class="sp-modal__card" role="dialog" aria-modal="true" aria-labelledby="calTitle">
    <button class="sp-modal__close" aria-label="Zavrieť">&times;</button>
    <div class="sp-modal__content">
      <div id="calTitle" class="spm-title"></div>
      <div class="spm-date"><i class="bi bi-calendar-event"></i> <span id="calDate"></span></div>
      <div id="calType" class="spm-tag"></div>
      <div class="ld-actions mt-2">
        <button id="calAddBtn"
                class="btn btn-outline-brand btn-compact"
                data-cta="add"
                data-kind="{{ kind }}"
                data-slug="{{ item.slug }}"
                data-label=""
                data-price=""
                data-cover="{{ url_for('static', filename='covers/cover.png') }}">
          <i class="bi bi-plus-circle"></i> Pridať do portfólia
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ========= KOMBINUJ PONUKU – MODAL (zjednodušené klikanie +) ========= -->
<div id="comboModal" class="sp-modal" aria-hidden="true">
  <div class="sp-modal__backdrop"></div>
  <div class="sp-modal__card sp-modal__card--combo" role="dialog" aria-modal="true" aria-labelledby="comboTitle" style="max-width:860px">
    <button class="sp-modal__close" aria-label="Zavrieť">&times;</button>

    <div class="sp-modal__content sp-modal__content--combo">
      <div id="comboTitle" class="spm-title" style="font-weight:700; margin-bottom:.25rem">Kombinuj ponuku</div>
      <div class="text-secondary" style="margin:0 0 .75rem">Vyber položky kliknutím na <b>+</b>. Vybrané položky sa sčítajú nižšie.</div>

      <div class="cmb-list" role="list">
        {% if item.inventory %}
        {% set SAMPLE = {
          'Logo na drese': 2500,
          'Banner v hale': 1200,
          'Livestream overlay': 700,
          'IG Reels': 300,
          'YouTube highlights': 400,
          'TikTok klipy': 300,
          'Mládežnícky deň': 900,
          'CSR aktivácia': 1500
        } %}
          {% for group, items in item.inventory.items() %}
            {% for it in items %}
              {% set rp0 = (
                it.price if it.price is defined and it.price else
                it.price_from if it.price_from is defined and it.price_from else
                it.budget if it.budget is defined and it.budget else
                it.amount if it.amount is defined and it.amount else
                it.value  if it.value  is defined and it.value  else
                it.cost   if it.cost   is defined and it.cost   else
                it.fee    if it.fee    is defined and it.fee    else
                0
              ) %}
              {% set rp = rp0 if rp0 else SAMPLE.get(it.name, 0) %}

              <div class="cmb-row" role="listitem" data-name="{{ it.name }}" data-price="{{ rp }}">
                <span class="cmb-icon"><i class="bi {{ it.icon }}"></i></span>
                <span class="cmb-name">{{ it.name }}</span>
                <span class="cmb-price" aria-label="Cena položky">{{ rp }}</span>
                <button type="button" class="pick-btn" aria-pressed="false" aria-label="Pridať {{ it.name }}"><i class="bi bi-plus-lg"></i></button>
              </div>
            {% endfor %}
          {% endfor %}
        {% endif %}
      </div>

      <!-- sticky footer -->
      <div class="spm-footer">
        <div class="spm-total">
          <span class="fw-semibold">Spolu</span>
          <span class="cmb-sum fw-bold">€0</span>
        </div>
        <button id="cmbAdd"
                class="btn btn-compact btn-cta-portfolio"
                data-cta="add"
                data-kind="{{ kind }}"
                data-slug="{{ item.slug }}"
                data-label=""
                data-price=""
                data-cover="{{ url_for('static', filename='covers/cover.png') }}"
                disabled>
          <i class="bi bi-plus-circle"></i> Pridať do portfólia
        </button>
      </div>
    </div>
  </div>
</div>


<!-- ===================== PAGE-LOCAL CSS ===================== -->
<style>
  :root{
    --brand-purple:#2d226c;
    --brand-accent:#774bfb;
    --sp-purple-filter: invert(33%) sepia(86%) saturate(7493%) hue-rotate(244deg) brightness(92%) contrast(104%);
  }
  .icon-16{width:16px;height:16px;vertical-align:-2px;display:inline-block}

  /* Breadcrumb base */
  .ld-breadcrumb{ background:#fff; }
  .bc-list{ margin:0; padding:.5rem 0; list-style:none; display:flex; gap:.5rem; align-items:center; }
  .bc-list li{ color:#6b7280; font-size:.9rem; }
  .bc-list li a{ color:#374151; text-decoration:none; }
  .bc-list li+li::before{ content:"/"; margin:0 .5rem; color:#9aa3b2; }

  .ld-breadcrumb{ border-bottom:none; margin:0; padding:10px 0 14px; }
  .ld-breadcrumb{ margin-top:-72px !important; }
/* desktop / default */
.ld-breadcrumb .bc-list{
  font-size:14px !important;
  line-height:1 !important;
}
.ld-breadcrumb .bc-list li,
.ld-breadcrumb .bc-list li a{ font-size:inherit !important; }
.ld-breadcrumb .bc-list li+li::before{
  content:"/";
  margin:0 .25rem;
  font-size:inherit !important;
}

/* ===== Mobile-only breadcrumb sizing & spacing tweak ===== */
@media (max-width: 576px){
  /* breadcrumbs (unchanged) */
  .ld-breadcrumb{ margin-top:-64px !important; padding:6px 0 8px; }
  .ld-breadcrumb .bc-list{ font-size:12px !important; }
  .ld-breadcrumb .bc-list li+li::before{ margin:0 .2rem; }

  /* tighten space under the pills */
  .ld-hero{ padding-bottom:10 !important; }                 /* kill hero's bottom padding */
  .ld-hero .row.g-3{ --bs-gutter-y: .25rem; }             /* shrink Bootstrap vertical gutter inside hero */
  .ld-metrics{ padding-bottom:0 !important; margin-bottom:0 !important; }

  /* also shrink the next section’s top padding (this is where the rest of the gap comes from) */
  section.py-3{ padding-top:.25rem !important; }          /* was ~1rem */

  /* optional: if you still see a hairline gap, use this tiny pull-up */
  .ld-hero{ margin-bottom:-2px; }
}


  /* Hero */
  .ld-hero{
    padding:.4rem 0 .5rem;
    background:
      radial-gradient(1200px 600px at 20% -10%, rgba(119,75,251,.06), transparent 65%),
      #f8f9f9 !important;
    border-bottom:1px solid var(--border);
    margin:0;
  }
  .ld-title{ font-weight:700; letter-spacing:-.01em; color:#0e1116; font-size:clamp(22px,2.5vw,34px); }
  .ld-avatar{ width:56px; height:56px; border-radius:50%; border:1px solid var(--border); object-fit:cover; }
  .sp-verified{ color:var(--brand-2); }
  .ld-card{ border:1px solid var(--border); box-shadow:0 8px 18px rgba(10,20,30,.04); }

  /* Cover */
  .ld-main-img-wrap{ border-bottom:1px solid var(--border); position:relative; }
  .ld-main-img{ width:100%; height:100%; object-fit:cover; display:block; }
  .ld-video{ position:absolute; inset:0; width:100%; height:100%; border:0; display:none; }
  .ld-grad{ position:absolute; inset:0; pointer-events:none; background:linear-gradient(180deg, rgba(0,0,0,0) 55%, rgba(0,0,0,.04) 100%); }

  .sport-pill{
    position:absolute; top:12px; right:12px; z-index:2;
    display:inline-flex; align-items:center; gap:.30rem;
    padding:.32rem .6rem; border-radius:999px; font-size:.82rem; font-weight:600;
    background:linear-gradient(135deg, rgba(119,75,251,.18), rgba(119,75,251,.08)), rgba(255,255,255,.92);
    border:1px solid #e6ddff; color:#3b2a85;
    box-shadow:0 10px 22px rgba(0,0,0,.08), 0 2px 0 rgba(119,75,251,.06) inset;
    backdrop-filter:saturate(120%) blur(2px);
  }
  .sport-pill i{ color:currentColor; }
  .sport-pill .icon-16{ filter:var(--sp-purple-filter); }

  /* Thumbs */
  .ld-thumbs-row{ position:relative; isolation:isolate; display:flex; gap:12px; overflow-x:auto; overflow-y:hidden; padding:6px; -webkit-overflow-scrolling:touch; scroll-snap-type:x proximity; scrollbar-width:none; cursor:grab;}
  .ld-thumbs-row::-webkit-scrollbar{ display:none; }
  .ld-thumbs-row.grabbing{ cursor:grabbing; user-select:none; }
  .ld-thumb{ border:1px solid var(--border); background:#fff; border-radius:14px; overflow:hidden; width:220px; height:120px; flex:0 0 auto; padding:0; cursor:pointer; transition:border-color .15s ease, transform .15s ease; position:relative; scroll-snap-align:start; }
  .ld-thumb:hover{ transform:translateY(-2px); }
  .ld-thumb.is-active{ border-color:#d7ceff; box-shadow:0 8px 18px rgba(119,75,251,.12); }
  .ld-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .ld-thumb-video .yt-badge{ position:absolute; left:10px; bottom:10px; width:34px; height:34px; border-radius:999px; display:grid; place-items:center; background:rgba(255,255,255,.9); border:1px solid #e6ddff; }
  .ld-thumb-video .yt-badge i{ font-size:20px; color:#6b5afc; }

  /* Text & chips */
  .ld-overview-text{ font-size:clamp(13px,.92rem,15px); line-height:1.6; }
  .ld-overview-text .link-plain{ text-decoration:underline; color:inherit; font-weight:500; font-size:.92em; }

  .ach-pill{ border:1px solid var(--border); background:#fff; border-radius:14px; padding:.55rem .8rem; display:flex; align-items:center; gap:.55rem; font-weight:400; font-size:.95rem; }
  .ach-logo{ width:22px; height:22px; object-fit:contain; }
  /* Smaller "Zobraziť viac" */
  .ach-more-btn{ font-size:.7rem !important; padding:.16rem .44rem !important; border-radius:999px; }

  .sp-tag{ display:inline-flex; align-items:center; gap:.28rem; padding:.32rem .56rem; border:1px dashed var(--border); border-radius:999px; background:#fff; color:#0e1116; font-size:.8rem; }
  .sp-tag .icon-16{ filter:var(--sp-purple-filter); }

  .sp-stat-chip{ display:inline-flex; align-items:center; gap:.28rem; padding:.32rem .5rem; border:1px solid var(--border); border-radius:999px; background:#fff; font-size:.8rem; color:#0e1116; white-space:nowrap; }
  .sp-stat-chip i{ color:#6b5afc; }

  /* Info dot (sidebar ER/CPM) */
  .mini-i{
    display:inline-grid; place-items:center;
    width:16px; height:16px; margin-left:6px;
    border:1px solid #e6ddff; border-radius:999px;
    color:#6b5afc; background:#fff; cursor:default; position:relative; top:-1px;
    font-style:normal; line-height:1;
  }
  .mini-i::before{ content:"i"; font-size:11px; font-weight:600; transform:translateY(0); }
  .mini-i:hover{ background:#f6f0ff; }
  .mini-i[data-tip]::after{
    content:attr(data-tip); position:absolute; left:50%; transform:translate(-50%,6px); bottom:-6px;
    opacity:0; pointer-events:none; transition:opacity .15s ease, transform .15s ease;
    white-space:normal; width:max(190px, 22ch); max-width:260px;
    background:#111827; color:#f3f4f6; border:1px solid rgba(119,75,251,.35);
    padding:.45rem .55rem; border-radius:10px; font-size:.78rem; font-weight:400; z-index:10000;
  }
  .mini-i:hover[data-tip]::after{ opacity:1; transform:translate(-50%,10px); }

  /* Buttons */
  .btn-outline-brand{ background:#fff; color:#3b2a85; border:1px solid #e6ddff; font-weight:600; border-radius:999px; }
  .btn-outline-brand:hover{ background:#f6f0ff; }
  .btn-ghost{ background:#fff; color:#0e1116; border:1px solid var(--border); border-radius:999px; }
  .btn-ghost:hover{ background:#f6f8fb; }
  .btn-slim{ padding:.3rem .6rem; border-radius:999px; font-size:.9rem; }
  .btn-compact{ padding:.36rem .6rem; font-size:.9rem; white-space:nowrap; }
  .btn-added{ background:#2d226c !important; color:#fff !important; border-color:#2d226c !important; }
  .btn-added i{ color:#fff !important; }
  .ld-actions{ display:flex; align-items:center; gap:8px; flex-wrap:nowrap; }

  /* Inventory & Plus */
  .ld-inv-grid{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  .inv-chip{ display:inline-flex; align-items:center; gap:.28rem; padding:.32rem .56rem; border:1px solid var(--border); border-radius:999px; background:#fff; font-size:.86rem; color:#0e1116; cursor:pointer; transition:box-shadow .15s ease, border-color .15s ease, background .15s ease; }
  .inv-chip i{ color:#6b5afc; }
  .inv-chip.is-selected{ border-color:#c9b9ff; background:linear-gradient(135deg, rgba(119,75,251,.08), rgba(119,75,251,.03)), #fff; box-shadow:0 4px 12px rgba(119,75,251,.12); }
  .inv-chip.is-added{ border-color:#a694ff; background:linear-gradient(135deg, rgba(119,75,251,.12), rgba(119,75,251,.05)), #fff; box-shadow:0 5px 14px rgba(119,75,251,.14); }
  .inv-add-btn{ display:none; align-items:center; justify-content:center; width:40px; height:40px; border-radius:999px; border:1px solid #e6ddff; background:#2d226c; color:#fff; box-shadow:0 10px 22px rgba(45,34,108,.28); cursor:pointer; margin-left:4px; flex:0 0 auto; position:relative; top:-2px; }
  .inv-add-btn.show{ display:inline-flex; }
  .inv-add-btn:disabled{ opacity:.45; cursor:not-allowed; box-shadow:none; }

  /* Packages */
  .ld-pack{ border:1px solid var(--border); border-radius:16px; background:#fff; padding:14px; box-shadow:0 10px 22px rgba(10,20,30,.04); }
  .ld-pack-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:.35rem; }
  .ld-pack-name{ font-weight:700; }
  .ld-price{ display:inline-flex; align-items:center; padding:.24rem .55rem; border-radius:999px; background:linear-gradient(135deg, rgba(119,75,251,.12), rgba(119,75,251,.06)), #fff; border:1px solid #e6ddff; color:#3b2a85; font-weight:600; font-size:.9rem; white-space:nowrap; }
  .ld-pack--combo{
    background:
      radial-gradient(800px 360px at 100% -20%, rgba(119,75,251,.12), transparent 60%),
      linear-gradient(180deg, #fafaff 0%, #ffffff 58%);
    border-color:#e6ddff;
  }

  /* Timeline / events */
  .ld-timeline{ display:grid; gap:12px; }
  .ld-tl-row{ display:flex; gap:12px; align-items:stretch; }
  .ld-tl-card{ border:1px solid var(--border); border-radius:14px; background:#fff; padding:.7rem; box-shadow:0 8px 18px rgba(10,20,30,.04); }
  .ld-datepill{ width:60px; border-radius:16px; background:#f8f7ff; border:1px solid #e6ddff; color:#3b2a85; display:flex; flex-direction:column; align-items:center; justify-content:center; line-height:1; gap:4px; }
  .ld-day{ font-size:24px; font-weight:800; }
  .ld-month{ font-size:13px; opacity:.85; }
  .ld-key-tag{ font-size:.72rem; padding:.12rem .35rem; border-radius:999px; border:1px solid #e6ddff; color:#3b2a85; background:#f6f0ff; margin-left:.35rem; }

  /* Calendar */
  .ld-cal{ border:1px solid var(--border); border-radius:16px; background:#fff; overflow:hidden; }
  .ld-cal-head{ display:flex; align-items:center; justify-content:space-between; padding:.5rem .75rem; border-bottom:1px solid var(--border); }
  .ld-cal-title{ font-weight:700; }
  .cal-nav{ border:1px solid var(--border); background:#fff; border-radius:999px; width:32px; height:32px; display:grid; place-items:center; }
  .ld-cal-grid{ display:grid; grid-template-columns:repeat(7,1fr); gap:6px; padding:.5rem; }
  .wday{ text-align:center; font-size:.8rem; color:#6b7280; padding:.2rem 0; }
  .day{ border:1px solid var(--border); border-radius:10px; background:#fff; padding:.4rem .45rem .45rem; min-height:86px; position:relative; display:flex; flex-direction:column; gap:4px; }
  .day.muted{ color:#9aa3b2; background:#fafbff; }
  .day-num{ position:absolute; top:6px; right:8px; font-size:.8rem; color:#6b7280; z-index:2; background:#fff; padding:0 2px; border-radius:4px; }
  .evt{ font-size:.72rem; line-height:1.2; background:#f6f0ff; border:1px solid #e6ddff; border-radius:8px; padding:.12rem .3rem; color:#3b2a85; overflow:hidden; text-overflow:ellipsis; white-space:normal; max-width:100%; cursor:pointer; }
  .day .evt:first-of-type{ margin-top:18px; }
  .day .evt + .evt{ margin-top:4px; }

  /* Project */
  .ld-proj{ border:1px solid var(--border); border-radius:18px; background:#fff; overflow:hidden; box-shadow:0 10px 22px rgba(10,20,30,.04); }
  .ld-proj-media{ width:100%; height:240px; overflow:hidden; }
  .ld-proj-media img{ width:100%; height:100%; object-fit:cover; display:block; }
  .ld-proj-body{ padding:14px; }
  .ld-proj-title{ font-weight:700; margin-bottom:.1rem; }

  /* Extra stats */
  .ld-statgrid{ display:grid; grid-template-columns:repeat(2,1fr); gap:10px; }
  @media (min-width:768px){ .ld-statgrid{ grid-template-columns:repeat(3,1fr);} }
  .stat{ border:1px solid var(--border); border-radius:14px; background:#fff; padding:.8rem .9rem; display:flex; align-items:center; justify-content:space-between; }
  .stat .label{ color:#6b7280; font-size:.9rem; }
  .stat .val{ font-weight:700; }

  /* Audience */
  .ld-aud-box{ border:1px solid var(--border); border-radius:16px; background:#fff; padding:.9rem; }
  .aud-chip{ display:inline-flex; align-items:center; gap:.35rem; padding:.36rem .7rem; border:1px solid var(--border); border-radius:999px; font-weight:700; background:#fff; color:#111827; font-size:.95rem; }
  .ld-aud-ages .ld-age-row{ display:flex; align-items:center; gap:12px; margin:.4rem 0; }
  .ld-age-label{ width:72px; color:#4b5563; font-weight:600; }
  .ld-age-bar{ flex:1; height:16px; background:#eff2f6; border-radius:999px; overflow:hidden; position:relative; }
  .ld-age-fill{ height:100%; background:var(--brand-accent); border-radius:999px; position:relative; display:block; }
  .ld-age-fill span{ position:absolute; right:6px; top:50%; transform:translateY(-50%); color:#fff; font-size:.8rem; font-weight:700; text-shadow:0 1px 0 rgba(0,0,0,.15); }
  .ld-age-fill.tiny span{ right:auto; left:100%; transform:translate(6px,-50%); color:#374151; text-shadow:none; }

  /* Sidebar */
  .ld-side{ border:1px solid var(--border); box-shadow:0 10px 22px rgba(10,20,30,.04); top:88px; }
  .ld-side-avatar{ width:44px; height:44px; border-radius:50%; border:1px solid var(--border); object-fit:cover; }
  .ld-side-facts{ display:grid; gap:.3rem; }
  .ld-mini-metrics{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
  .ld-mm{ border:1px solid var(--border); background:#fff; border-radius:12px; padding:.6rem .7rem; text-align:center; }

  /* Toasts */
  .sp-toast{ position:fixed; right:18px; bottom:18px; background:rgba(16,18,27,.9); border:1px solid rgba(119,75,251,.35); color:#eef; border-radius:16px; padding:.9rem 1rem; box-shadow:0 18px 40px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.04) inset; display:flex; align-items:center; gap:.85rem; z-index:9999; opacity:0; transform:translateY(10px); transition:opacity .2s ease, transform .2s ease; max-width:92vw; width:min(420px,92vw); backdrop-filter:saturate(120%) blur(8px); }
  .sp-toast--light{ background:rgba(255,255,255,.96); border:1px solid #e9ecf3; color:#0e1116; box-shadow:0 16px 36px rgba(0,0,0,.18); }
  .sp-toast.show{ opacity:1; transform:translateY(0); }
  .sp-toast img{ width:44px; height:44px; object-fit:cover; border-radius:12px; border:1px solid rgba(119,75,251,.35); }
  .sp-toast .t-hed{ font-size:.78rem; letter-spacing:.02em; color:#bdb7ff; margin-bottom:.1rem; }
  .sp-toast--light .t-hed{ color:#5b5bd6; }
  .sp-toast .t-title{ font-weight:800; line-height:1.15; color:#fff; }
  .sp-toast--light .t-title{ color:#0e1116; }
  .sp-toast .t-price{ font-weight:800; color:#e9e6ff; }
  .sp-toast--light .t-price{ color:#2d226c; }
  .sp-toast .t-link{ margin-top:.35rem; display:inline-block; text-decoration:underline; color:#cfcaff; }
  .sp-toast--light .t-link{ color:#2d226c; }
  .sp-toast .t-close{ margin-left:auto; background:transparent; border:0; color:#d8d5ff; font-size:20px; line-height:1; cursor:pointer; }
  .sp-toast--light .t-close{ color:#444; }

  /* Modal */
  .sp-modal{ position:fixed; inset:0; display:none; z-index:9998; }
  .sp-modal.is-open{ display:block; }
  .sp-modal__backdrop{ position:absolute; inset:0; background:rgba(9,11,17,.45); backdrop-filter:blur(4px); }
  .sp-modal__card{ position:relative; max-width:600px; width:calc(100% - 28px); margin:6vh auto; background:#ffffff; color:#0e1116; border:1px solid #e6ddff; border-radius:18px; box-shadow:0 24px 60px rgba(18,20,28,.25); }
  .sp-modal__close{ position:absolute; top:10px; right:12px; background:transparent; border:0; color:#111; font-size:26px; line-height:1; cursor:pointer; }
  .sp-modal__content{ padding:18px 18px 20px; }
  .spm-title{ font-size:1.25rem; font-weight:800; color:#0e1116; }

  /* ------- Builder list (combo modal) ------- */
  .cmb-list{ display:grid; gap:10px; }
  .cmb-row{
    position:relative;
    display:grid; grid-template-columns:auto 1fr auto auto; align-items:center; gap:12px;
    border:1px solid var(--border); background:#fff; border-radius:14px; padding:10px 12px; transition:box-shadow .15s ease, border-color .15s ease, background .15s ease;
  }
  .cmb-row.is-picked{
    border-color:#c9b9ff;
    background:linear-gradient(135deg, rgba(119,75,251,.08), rgba(119,75,251,.03)), #fff;
    box-shadow:0 4px 12px rgba(119,75,251,.12);
  }
  .cmb-icon i{ color:#6b5afc; font-size:18px; }
  .cmb-name{ font-weight:600; }
  /* Price pill – match the screenshot (€950+) */
  #comboModal .cmb-price{
    display:inline-flex; align-items:center; line-height:1;
    font-weight:700;                /* lighter */
    font-size:.95rem; letter-spacing:.01em;
    padding:.26rem .68rem;
    border:1px solid #e6ddff; border-radius:999px;
    color:#2d226c;
    background:#f5f0ff;            /* single flat color */
    box-shadow:none;                /* no inner highlight */
  }
  .pick-btn{
    width:36px; height:36px; display:grid; place-items:center; border:1px solid #e6ddff; background:#fff; border-radius:10px; cursor:pointer;
  }
  .cmb-row.is-picked .pick-btn{ background:#f6f0ff; border-color:#d8ccff; }

  /* ----- Footer totals & CTA ----- */
  #comboModal .spm-footer{
    position:sticky; bottom:0; z-index:2;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:10px 12px;
    background:linear-gradient(180deg, rgba(255,255,255,.88), #fff);
    border-top:1px solid #e6ddff;
    backdrop-filter:saturate(120%) blur(6px);
  }
  #comboModal .spm-total{ display:flex; align-items:center; gap:.6rem; font-size:1rem; }
  #comboModal .cmb-sum{ font-weight:800; }

  /* Výrazný CTA štýl (ružovo-fialový) */
  .btn-cta-portfolio{
    display:inline-flex; align-items:center; justify-content:center;
    font-weight:700;                 /* lighter */
    letter-spacing:.01em;
    padding:.46rem 1rem; border-radius:999px;
    border:1px solid #e6ddff; color:#2d226c;
    background:#f5f0ff;             /* single flat color */
    box-shadow:none;                 /* remove glow */
    transition:background .15s ease, transform .06s ease;
  }
  .btn-cta-portfolio:hover{ background:#efe7ff; transform:translateY(-1px); }
  .btn-cta-portfolio:active{ transform:translateY(0); }
  .btn-cta-portfolio:disabled{ opacity:.55; cursor:not-allowed; }

  /* keep your existing success state as-is */
  .btn-added{
    background:#2d226c !important; color:#fff !important; border-color:#2d226c !important;
  }

  /* More space between + icon and text on the footer CTA */
  #comboModal .spm-footer #cmbAdd{
    display:inline-flex;             /* ensure flex so gap works */
    align-items:center;
    gap:.45rem;                      /* ← space between icon and label */
  }
  #comboModal .spm-footer #cmbAdd i{ margin:0; }  /* reset any inherited margin */

  /* Mobile tweaks */
  .ld-breadcrumb,.ld-hero{
    background:
      radial-gradient(900px 450px at 8% -20%, rgba(119,75,251,.06), transparent 65%),
      #f8f9f9 !important;
  }
  .ld-seg{ gap:6px; }
  .seg-btn{ display:inline-flex; align-items:center; justify-content:center; width:38px; height:38px; border-radius:999px; border:1px solid #e6ddff; background:#fff; color:#3b2a85; font-weight:600; text-decoration:none; transition:background .15s ease, border-color .15s ease, transform .1s ease; }
  .seg-btn i{ font-size:1.05rem; line-height:1; }
  .seg-btn:hover{ background:#f6f0ff; border-color:#d8ccff; transform:translateY(-1px); }
  .seg-btn:focus-visible{ outline:2px solid #b7a6ff; outline-offset:2px; }

  .ld-mobile-nav{ position:sticky; top:64px; z-index:10; margin:.6rem 0 0; display:flex; gap:8px; overflow:auto; padding-bottom:6px; }
  .ld-mobile-nav .mnav{ border:1px solid var(--border); background:#fff; border-radius:999px; padding:.45rem .7rem; font-size:.95rem; white-space:nowrap; }

  /* ======== Mobile polish (app-like) – safely additive ======== */

  /* --- Small tablets & phones (≤768px) --- */
  @media (max-width:768px){

    /* Page breathing room */
    .container { padding-left:14px; padding-right:14px; }

    /* Hero: tighter, readable, wraps cleanly */
    .ld-hero{ padding:.25rem 0 .4rem; }
    .ld-title{ font-size:clamp(20px,5.6vw,28px); line-height:1.15; }
    .ld-avatar{ width:48px; height:48px; }
    .ld-meta{ gap:6px !important; }

    /* Chips slightly smaller for wrap density */
    .sp-tag,
    .sp-stat-chip{ font-size:.78rem; padding:.34rem .52rem; }

    /* “Sport pill” on cover – compact + safe edge insets */
    .sport-pill{
      top:8px; right:8px;
      font-size:.78rem; padding:.28rem .52rem;
      box-shadow:0 8px 18px rgba(0,0,0,.08), 0 1px 0 rgba(119,75,251,.06) inset;
    }

/* --- Phones (≤576px) — smaller gallery thumbs --- */
@media (max-width:576px){
  .ld-thumbs-row{ gap:6px; padding:6px; }

  /* smaller thumbnails (keep ~16:9 ratio) */
  .ld-thumb{
    width:24vw;
    height:calc(24vw * 9/16);
    border-radius:12px; /* keep your rounded look */
  }

  /* optional: smaller play badge on video thumb */
  .ld-thumb-video .yt-badge{
    width:28px;
    height:28px;
  }
}

    /* Cards: gentle compaction */
    .ld-card{ border-radius:14px; }
    .ld-pack{ padding:12px; }
    .ld-pack-head{ gap:8px; }
    .ld-price{ font-size:.86rem; padding:.22rem .52rem; }

    /* Actions: full-width buttons like an app */
    .ld-actions{ flex-wrap:wrap; gap:8px; }
    .btn-compact,
    .btn-ghost,
    .btn-outline-brand{ width:100%; }

    /* Achievements list – 1 column on small screens */
    .ach-pill{ font-size:.92rem; }

    /* Timeline/event rows: slightly smaller date pill */
    .ld-tl-row{ align-items:stretch; }
    .ld-datepill{ width:54px; }
    .ld-tl-card{ padding:.6rem .6rem; }

    /* Calendar: compact grid */
    .ld-cal-grid{ gap:4px; }
    .day{ min-height:70px; padding:.36rem .42rem; }
    .day-num{ right:6px; }

    /* Projects: responsive media height */
    .ld-proj-media{ height:46vw; }

    /* Sidebar stops being sticky; buttons go full width */
    .ld-side{ position:static; top:auto; }
    .ld-side .btn-compact{ width:100%; }

    /* Quick mobile nav – more “app” feel */
    .ld-mobile-nav{
      top:64px;
      padding:6px;
      background:rgba(255,255,255,.9);
      border:1px solid var(--border);
      border-radius:12px;
      box-shadow:0 10px 24px rgba(0,0,0,.06);
      backdrop-filter:saturate(120%) blur(6px);
    }
    .ld-mobile-nav .mnav{
      flex:1 1 auto;
      text-align:center;
      padding:.55rem .7rem;
      font-weight:600;
    }

    /* Breadcrumb: scrollable if long, no crowding */
    .ld-breadcrumb{ margin-top:-64px !important; padding:6px 0 10px; }
    .ld-breadcrumb .bc-list{ gap:.25rem; overflow:auto; -webkit-overflow-scrolling:touch; }
    .ld-breadcrumb .bc-list li,
    .ld-breadcrumb .bc-list li a{ font-size:13px; white-space:nowrap; }
  }

  /* --- Phones (≤576px) – fine-grain tweaks --- */
  @media (max-width:576px){
    /* keep your originals */
    .day{ min-height:64px; padding:.35rem .4rem; }
    .ld-day{ font-size:20px; }
    .evt{ font-size:.68rem; }
    .ld-age-bar{ height:14px; }
    .ld-age-label{ width:64px; }

    /* + additional compacting */
    .ld-statgrid{ grid-template-columns:1fr; }
    .ld-proj-body{ padding:12px; }
    .ld-overview-text{ font-size:.95rem; }
    .seg-btn{ width:40px; height:40px; }
  }


  /* ==== (pôvodný) modal layout basics ostávajú ==== */
  #comboModal .sp-modal__card--combo{ max-height:88vh; display:flex; flex-direction:column; }
  #comboModal .sp-modal__content--combo{ display:flex; flex-direction:column; min-height:0; padding:14px 14px 0; gap:8px; }
  #comboModal .cmb-list{ flex:1 1 auto; min-height:0; overflow:auto; padding-bottom:8px; }

@media (max-width: 576px){
  .ld-hero .ld-metrics{
    display:flex !important;
    flex-wrap: nowrap !important;          /* keep one row */
    justify-content: flex-start !important;/* ← LEFT */
    align-items: center;
    gap: 6px;

    overflow-x: auto !important;           /* allow swipe if it overflows */
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;

    width: 100% !important;
    margin: 4px 0 8px !important;          /* remove auto-centering */
    padding: 0;
  }
  .ld-hero .ld-metrics::-webkit-scrollbar{ display:none; }
  .ld-hero .ld-metrics .sp-stat-chip{
    flex: 0 0 auto;
    white-space: nowrap;
    font-size: .72rem;
    padding: .26rem .44rem;
    border-radius: 12px;
  }
}

/* extra squeeze for very small phones (optional) */
@media (max-width: 360px){
  .ld-metrics .sp-stat-chip{ font-size:.68rem; padding:.22rem .38rem; }
}

@media (max-width: 576px){
  /* smaller “Trenčiansky kraj” line */
  .ld-hero .ld-meta{
    font-size: clamp(12px, 3.6vw, 14px);
  }
  .ld-hero .ld-meta .bi{ transform: translateY(-.5px); } /* tiny icon alignment */
}

@media (max-width: 576px){
  /* smaller “Trenčiansky kraj” line */
  .ld-hero .ld-meta{
    font-size: clamp(12px, 3.6vw, 14px);
  }
  .ld-hero .ld-meta .bi{ transform: translateY(-.5px); } /* tiny icon alignment */
}

/* Mobile: hide only the sport chip ("Pozemný hokej") in the hero */
@media (max-width: 576px){
  .ld-hero .ld-meta .sp-tag{
    display: none !important;
  }
}

/* Mobile: container for socials when placed inside #overview */
@media (max-width: 576px){
  .ld-overview-social{
    display:flex;
    gap:8px;
    margin-top:.75rem;          /* breathing room below the Prehľad text */
    flex-wrap:wrap;             /* just in case there are many icons */
  }
  .ld-overview-social .seg-btn{
    width:42px;                 /* same look & touch target */
    height:42px;
  }
}

/* Hide the quick nav on phones */
@media (max-width: 576px){
  .ld-mobile-nav{
    display: none !important;
  }
}

@media (max-width: 991.98px){
  .ld-mobile-nav{ display:none !important; }
}

/* ===== Mobile-only breadcrumb sizing & spacing tweak ===== */
@media (max-width: 576px){
  /* menšie breadcrumbs */
  .ld-breadcrumb .bc-list{
    font-size: 12px !important;   /* z 14px -> 12px */
  }

  /* menší „odskok“ pod radou s metrikami */
  .ld-hero{
    padding-bottom: .2rem;         /* jemne skráti spodný padding hero sekcie */
  }
  .ld-metrics{
    padding-bottom: 2px;           /* menší vnútorný spodný odstup */
    margin-bottom: 4px;            /* menší vonkajší odstup pod pillmi */
  }

  /* voliteľné: ak chceš úplne minimálny rozstup nad ďalšou sekciou */
  section.py-3{
    padding-top: .75rem;           /* default BS py-3 je 1rem; zjemní to pre mobil */
  }
}

@media (max-width: 576px){
  /* keep the title + button on one row and push the button to the right */
  .ach-head{
    flex-wrap: nowrap;              /* stop wrapping */
    gap: 8px;
  }

  /* make THIS button not full-width on mobile */
  .ach-head .ach-more-btn{
    width: auto !important;         /* override your .btn-ghost { width:100% } */
    flex: 0 0 auto;
    white-space: nowrap;
  }
}

/* Mobile: hide subtitle + keep title on one line */
@media (max-width: 576px){
  #season .season-sub{
    display: none !important;          /* hide “Vyber balík…” */
  }
  #season .season-title{
    white-space: nowrap;                /* keep in one row */
    overflow: hidden;                   /* avoid wrapping issues */
    text-overflow: ellipsis;            /* safe truncation if ever needed */
    letter-spacing: -.01em;
  }
}

/* MOBILE — projekty: title + cena v jednej línii, opis nižšie */
@media (max-width: 576px){
  /* hlavička karty (ľavá časť + cena) */
  .ld-proj-body > .d-flex{
    align-items: center !important;  /* zarovnaj vertikálne */
    gap: 8px;
  }
  .ld-proj-body > .d-flex > div:first-child{
    flex: 1 1 auto;                  /* nech ľavý stĺpec zaberie šírku */
    min-width: 0;                     /* povolí skrátenie titulku */
  }
  .ld-proj-body .ld-price{
    flex: 0 0 auto;
    align-self: center;
  }

  /* posun titulku o 2px dolu, aby lícoval s cenou */
  .ld-proj-body .ld-proj-title{
    margin: 0;
    position: relative;
    top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}

/* AFTER – hit the real element */
@media (max-width:576px){
  /* keep title and price aligned */
  .ld-proj-body .ld-proj-head{ align-items:center !important; }
  .ld-proj-body .ld-proj-head .ld-proj-title{
    position:relative; top:2px; margin:0;  /* 2px down */
  }
  .ld-proj-body .ld-price{ align-self:center; }

  /* push the description LOWER */
  .ld-proj-body .ld-proj-desc{
    margin-top:10px !important;   /* tweak 6–14px to taste */
    line-height:1.55;
    display:block;
  }
}

@media (max-width:576px){
  .ld-proj-body .ld-proj-head + .text-secondary{
    margin-top:10px !important;
    line-height:1.55;
    display:block;
  }
}

/* MOBILE: keep title + price on one line, nudge title 2px down,
   and give the description a small top margin */
@media (max-width: 576px){
  .ld-proj-body .ld-proj-head{
    /* override the d-flex on phones for reliable alignment */
    display: grid;
    grid-template-columns: 1fr auto;  /* title grows, price hugs right */
    align-items: center;
    column-gap: 8px;
    margin-bottom: 0;
  }

  .ld-proj-body .ld-proj-title{
    position: relative;
    top: 2px;           /* ← move title down by 2px */
    margin: 0;          /* avoid extra top spacing from utilities */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .ld-proj-body .ld-proj-desc{
    margin-top: 8px !important;  /* ← small gap above the text */
    display: block;
    line-height: 1.55;           /* readability (optional) */
  }
}

/* --- Events header: mobil --- */
@media (max-width: 576px){
  /* rozloženie: názov vľavo (1fr), malé tlačidlo vpravo (auto) */
  #events .events-head{
    display: grid;                 /* prebijeme d-flex */
    grid-template-columns: 1fr auto;
    align-items: center;
    column-gap: 8px;
  }

  /* menšie písmo nadpisu, nech sa zmestí do jedného riadku */
  #events .events-head h2{
    margin: 0;
    font-size: 1.125rem;           /* cca 18px, uprav podľa potreby */
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;                   /* dôležité kvôli ellipsis */
  }

  #allToggle{
    width: auto !important;
    flex: 0 0 auto;
    padding: .18rem .48rem;     /* ↓ smaller padding */
    font-size: .78rem;          /* ↓ smaller text */
    line-height: 1.1;           /* tighter height */
    white-space: nowrap;
  }
  #allToggle i{
    margin-right: .30rem;       /* a bit tighter */
    font-size: .95em;           /* slightly smaller icon */
  }

  /* skrátený text tlačidla iba na mobile */
  #allToggle .lab-long{ display: none; }
  #allToggle .lab-short{ display: inline; }
}

/* na väčších obrazovkách nech ostane pôvodný dlhý text */
@media (min-width: 577px){
  #allToggle .lab-long{ display: inline; }
  #allToggle .lab-short{ display: none; }
}

/* Mobile-only: hide CPM chip in the hero metrics row */
@media (max-width: 576px){
  .ld-hero .ld-metrics .sp-stat-chip:has(.bi-bar-chart){
    display: none !important;
  }
}

/* (Optional) Also hide the CPM row in the right sidebar on mobile */
@media (max-width: 576px){
  .ld-side-facts > div:has(.mini-i[data-tip^="Cost per Mille"]){
    display: none !important;
  }
}

/* --- Jednotná výrazná farba pre všetky `Pridať do portfólia` --- */
:root { --add-cta: #3a2a85; }   /* môžeš zmeniť podľa chuti */

/* default stav (kým ešte nie je pridané) */
button[data-cta="add"]:not(.btn-added),
a[data-cta="add"]:not(.btn-added){
  background: var(--add-cta) !important;
  border-color: var(--add-cta) !important;
  color:#fff !important;
  box-shadow: 0 2px 2px rgba(118,74,251,.22);
}

/* ikonka nech je biela rovnako ako text */
[data-cta="add"] i{ color: currentColor !important; }

/* interakcie */
[data-cta="add"]:not(.btn-added):hover{ filter: brightness(0.95); }
[data-cta="add"]:not(.btn-added):active{ filter: brightness(0.90); transform: translateY(0); }
[data-cta="add"]:focus-visible{ outline: 2px solid var(--add-cta); outline-offset: 2px; }

/* stav po pridaní nech ostáva tak, ako máš (tmavofialová) */
[data-cta="add"].btn-added{
  background:#122633 !important;
  border-color:#122633 !important;
  color:#fff !important;
}
[data-cta="add"].btn-added i{ color:#fff !important; }
</style>

<!-- ===================== PAGE-LOCAL JS ===================== -->
<script>
  /* Smooth scroll anchors */
  function smoothTo(sel){
    const el = document.querySelector(sel);
    if(!el) return;
    const y = el.getBoundingClientRect().top + window.pageYOffset - 96;
    window.scrollTo({top:y, behavior:'smooth'});
  }
  document.querySelectorAll('[data-scroll]').forEach(btn=>{
    btn.addEventListener('click', e=>{
      e.preventDefault();
      smoothTo(btn.getAttribute('data-scroll'));
    });
  });

  /* Thumbs: drag-to-scroll + NOT-drag click on pointerup */
  document.addEventListener('DOMContentLoaded', function(){
    const wrap = document.getElementById('ldMainWrap');
    const img  = document.getElementById('ldMain');
    const row  = document.querySelector('.ld-thumbs-row');
    if(!wrap || !img || !row) return;

    // create (hidden) iframe once
    const iframe = document.createElement('iframe');
    iframe.className = 'ld-video';
    iframe.setAttribute('allowfullscreen', '');
    iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share');
    wrap.appendChild(iframe);

    // parse yt id from data-yt (already set in your Jinja)
    const ytUrl = wrap.getAttribute('data-yt') || '';
    const ytId = (function(u){
      try{
        const url = new URL(u);
        if (url.hostname.includes('youtu.be')) return url.pathname.replace('/','');
        if (url.searchParams.get('v')) return url.searchParams.get('v');
        const parts = url.pathname.split('/'); return parts[parts.length-1] || '';
      }catch(_){ return ''; }
    })(ytUrl);

    // show correct YT preview on the video thumb
    const videoThumb = row.querySelector('.ld-thumb-video');
    if (videoThumb && ytId){
      const imgEl = videoThumb.querySelector('img');
      if (imgEl) imgEl.src = `https://img.youtube.com/vi/${ytId}/hqdefault.jpg`;
      videoThumb.dataset.video = ytUrl; // ensure it's present
    }

    function showImage(src){
      if(!src) return;
      iframe.style.display = 'none';
      iframe.src = '';
      img.style.display = 'block';
      if (img.src !== src) img.src = src;
    }
    function showVideo(){
      if(!ytId) return;
      img.style.display = 'none';
      iframe.src = `https://www.youtube.com/embed/${ytId}?autoplay=1&rel=0`;
      iframe.style.display = 'block';
    }
    function activate(btn){
      if(!btn) return;
      row.querySelectorAll('.ld-thumb.is-active').forEach(b=>b.classList.remove('is-active'));
      btn.classList.add('is-active');
      if (btn.hasAttribute('data-video')) showVideo();
      else showImage(btn.getAttribute('data-src'));
    }

    // ---- Drag + click-on-pointerup (no timing race with click) ----
    let isDown=false, startX=0, scrollStart=0, moved=false, downTarget=null;

    row.addEventListener('pointerdown', (e)=>{
      isDown=true; moved=false; downTarget = e.target.closest('.ld-thumb');
      startX=e.clientX; scrollStart=row.scrollLeft;
      row.classList.add('grabbing');
      if(e.pointerType==='mouse') e.preventDefault();
      row.setPointerCapture?.(e.pointerId);
    });

    row.addEventListener('pointermove', (e)=>{
      if(!isDown) return;
      const dx=e.clientX-startX;
      if(Math.abs(dx)>5) moved=true;
      row.scrollLeft = scrollStart - dx;
    });

    function endDrag(e){
      if(!isDown) return;
      isDown=false;
      row.classList.remove('grabbing');
      row.releasePointerCapture?.(e.pointerId);

      // if we *didn't* drag, treat as click on the thumb we pressed
      if(!moved){
        const upTarget = e.target.closest('.ld-thumb');
        // require press & release on the same thumb (prevents weirdness)
        if (upTarget && upTarget === downTarget){
          e.preventDefault();
          activate(upTarget);
        }
      }
      downTarget=null;
    }

    row.addEventListener('pointerup', endDrag);
    row.addEventListener('pointercancel', endDrag);
    row.addEventListener('mouseleave', endDrag);

    // keyboard access
    row.querySelectorAll('.ld-thumb').forEach(b=>{
      b.setAttribute('type','button');
      b.setAttribute('tabindex','0');
      b.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          activate(b);
        }
      });
    });
  });

  /* Achievements toggle */
  (function(){
    const btn = document.getElementById('achToggle');
    if(!btn) return;
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.extra-ach').forEach(n=>n.classList.toggle('d-none'));
      btn.textContent = /viac/i.test(btn.textContent) ? 'Skryť' : 'Zobraziť viac';
    });
  })();

  /* Portfolio storage */
  function getPortfolio(){ try{ return JSON.parse(localStorage.getItem('portfolio_items')||'[]'); }catch(_){ return []; } }
  function setPortfolio(arr){ localStorage.setItem('portfolio_items', JSON.stringify(arr)); if(window.updatePortfolioBadge){ window.updatePortfolioBadge(); } }
  function addToPortfolio(p){ const l=getPortfolio(); if(!l.some(x=>x.kind===p.kind&&x.slug===p.slug&&x.label===p.label)){ l.push(p); setPortfolio(l);} }
  function removeFromPortfolio(label){ setPortfolio(getPortfolio().filter(x=>x.label!==label)); }
  function isInPortfolio(label){ return getPortfolio().some(x=>x.label===label); }
  function cssEscapeSel(str){ return str.replace(/("|'|\\)/g,'\\$1'); }
  function markAddedUI(label){
    document.querySelectorAll(`[data-cta="add"][data-label="${cssEscapeSel(label)}"]`).forEach(b=>{
      b.innerHTML='<i class="bi bi-check2-circle"></i> Pridané';
      b.classList.remove('btn-outline-brand'); b.classList.add('btn-added');
    });
  }
  function unmarkAddedUI(label){
    document.querySelectorAll(`[data-cta="add"][data-label="${cssEscapeSel(label)}"]`).forEach(b=>{
      b.innerHTML='<i class="bi bi-plus-circle"></i> Pridať do portfólia';
      b.classList.add('btn-outline-brand'); b.classList.remove('btn-added');
    });
  }
  function syncAllAddButtons(){
    document.querySelectorAll('[data-cta="add"]').forEach(b=>{
      const lbl=b.dataset.label||''; if(!lbl) return;
      if(isInPortfolio(lbl)) markAddedUI(lbl); else unmarkAddedUI(lbl);
    });
  }

  /* Toasts */
  const CLUB_LOGO_URL = "{{ url_for('static', filename=item.avatar) }}";
  function showToastAdd({label, price, logo, linkHref, header}){
    const t=document.createElement('div');
    t.className='sp-toast';
    t.innerHTML=`<img src="${logo||''}" alt="logo"><div class="t-wrap"><div class="t-hed">${header||'Pridané do portfólia'}</div><div class="t-title">${label||'Položka pridaná'}</div>${price?`<div class="t-price">${price}</div>`:''}<a class="t-link" href="${linkHref||'/portfolio'}">Zobraziť portfólio</a></div><button class="t-close" aria-label="Zavrieť">×</button>`;
    document.body.appendChild(t);
    const close=()=>{t.classList.remove('show'); t.addEventListener('transitionend',()=>t.remove(),{once:true});};
    t.querySelector('.t-close').addEventListener('click',close);
    requestAnimationFrame(()=>t.classList.add('show')); setTimeout(close,8000);
  }
  function showToastRemove({label, logo, linkHref}){
    const t=document.createElement('div');
    t.className='sp-toast sp-toast--light';
    t.innerHTML=`<img src="${logo||''}" alt="logo"><div class="t-wrap"><div class="t-hed">Odstránené z portfólia</div><div class="t-title">${label||''}</div><a class="t-link" href="${linkHref||'/portfolio'}">Zobraziť portfólio</a></div><button class="t-close" aria-label="Zavrieť">×</button>`;
    document.body.appendChild(t);
    const close=()=>{t.classList.remove('show'); t.addEventListener('transitionend',()=>t.remove(),{once:true});};
    t.querySelector('.t-close').addEventListener('click',close);
    requestAnimationFrame(()=>t.classList.add('show')); setTimeout(close,6000);
  }

  /* Add-to-portfolio CTAs (exclude modal + calendar) */
  document.querySelectorAll('[data-cta="add"]:not(#calAddBtn):not(#cmbAdd)').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const label = btn.dataset.label||'';
      const payload = {
        kind: btn.dataset.kind, slug: btn.dataset.slug, label,
        price_from: Number((btn.dataset.price||'').toString().replace(/[^\d.]/g,'')) || 0,
        cover: btn.dataset.cover
      };
      if(isInPortfolio(label)){
        removeFromPortfolio(label); unmarkAddedUI(label);
        showToastRemove({label, logo:CLUB_LOGO_URL, linkHref:'/portfolio'});
      }else{
        addToPortfolio(payload); markAddedUI(label);
        showToastAdd({label, price:(btn.dataset.price||'').trim(), logo:CLUB_LOGO_URL, linkHref:'/portfolio'});
      }
    });
  });

  /* Modal add/remove (calendar) */
  (function(){
    const calModal = document.getElementById('calModal');
    const calTitle = document.getElementById('calTitle');
    const calDate  = document.getElementById('calDate');
    const calType  = document.getElementById('calType');
    const calAddBtn = document.getElementById('calAddBtn');
    const calDateRow = document.querySelector('.spm-date');

    function openEventModal(evData){
      if(!calModal) return;
      calTitle.textContent = evData.title || '';
      calDate.textContent  = evData.date  || '';
      calType.textContent  = evData.type  || '';
      calDateRow.style.display = evData.date ? '' : 'none';

      const lbl = "{{ item.title }} – " + (evData.labelSuffix || evData.title || 'Event');
      calAddBtn.dataset.label = lbl;
      calAddBtn.dataset.price = "";
      if(isInPortfolio(lbl)) markAddedUI(lbl); else unmarkAddedUI(lbl);

      calAddBtn.onclick = (e)=>{
        e.preventDefault(); e.stopImmediatePropagation?.();
        const payload = { kind:calAddBtn.dataset.kind, slug:calAddBtn.dataset.slug, label:calAddBtn.dataset.label, price_from:0, cover:calAddBtn.dataset.cover };
        if(isInPortfolio(payload.label)){
          removeFromPortfolio(payload.label); unmarkAddedUI(payload.label);
          calAddBtn.classList.remove('btn-added'); calAddBtn.classList.add('btn-outline-brand');
          calAddBtn.innerHTML='<i class="bi bi-plus-circle"></i> Pridať do portfólia';
          showToastRemove({label:payload.label, logo:CLUB_LOGO_URL, linkHref:'/portfolio'});
        }else{
          addToPortfolio(payload); markAddedUI(payload.label);
          calAddBtn.classList.add('btn-added'); calAddBtn.classList.remove('btn-outline-brand');
          calAddBtn.innerHTML='<i class="bi bi-check2-circle"></i> Pridané';
          showToastAdd({label:payload.label, price:'', logo:CLUB_LOGO_URL, linkHref:'/portfolio'});
        }
      };

      calModal.classList.add('is-open'); document.body.style.overflow='hidden';
    }
    function closeEventModal(){ if(!calModal) return; calModal.classList.remove('is-open'); document.body.style.overflow=''; }
    if(calModal){
      calModal.querySelector('.sp-modal__backdrop').addEventListener('click', closeEventModal);
      calModal.querySelector('.sp-modal__close').addEventListener('click', closeEventModal);
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeEventModal(); });
    }
    window.openEventModal = openEventModal;
  })();

  /* Mini calendar build */
  (function(){
    const root=document.getElementById('calendar'); if(!root) return;
    const grid=root.querySelector('.ld-cal-grid'); const title=root.querySelector('.ld-cal-title');
    const events=(()=>{ try{return JSON.parse(root.dataset.events||'[]');}catch(_){return[];} })();
    let view=new Date(); view.setDate(1);

    function addDayCell(n,muted=false,evs=[]){
      const d=document.createElement('div'); d.className='day'+(muted?' muted':'');
      const num=document.createElement('span'); num.className='day-num'; num.textContent=n; d.appendChild(num);
      (evs||[]).slice(0,2).forEach(e=>{
        const b=document.createElement('div'); b.className='evt'; b.textContent=e.title||'';
        b.addEventListener('click',()=>window.openEventModal({title:e.title,date:e.date,type:e.type}));
        d.appendChild(b);
      });
      grid.appendChild(d);
    }

    function render(){
      grid.querySelectorAll('.day').forEach(d=>d.remove());
      const y=view.getFullYear(), m=view.getMonth();
      title.textContent=(['Január','Február','Marec','Apríl','Máj','Jún','Júl','August','September','Október','November','December'])[m]+' '+y;
      const first=(view.getDay()+6)%7, days=new Date(y,m+1,0).getDate(), prev=new Date(y,m,0).getDate();
      for(let i=first-1;i>=0;i--) addDayCell(prev-i,true,[]);
      for(let dnum=1; dnum<=days; dnum++){
        const ds=`${y}-${String(m+1).padStart(2,'0')}-${String(dnum).padStart(2,'0')}`;
        addDayCell(dnum,false,events.filter(e=>e.date===ds));
      }
      const cells=grid.querySelectorAll('.day,.wday').length-7, mod=cells%7, tail=(mod===0)?0:(7-mod);
      for(let i=1;i<=tail;i++) addDayCell(i,true,[]);
    }

    render();
    root.querySelectorAll('.cal-nav').forEach(btn=>{
      btn.addEventListener('click', ()=>{ view.setMonth(view.getMonth()+Number(btn.dataset.dir||1)); render(); });
    });
  })();

  /* Inventory multi-select + PLUS */
  (function(){
    const grid=document.getElementById('invGrid'); if(!grid) return;
    const plusBtn=document.createElement('button');
    plusBtn.className='inv-add-btn'; plusBtn.innerHTML='<i class="bi bi-plus-lg"></i>'; plusBtn.title='Pridať vybrané do portfólia';
    plusBtn.dataset.kind="{{ kind }}"; plusBtn.dataset.slug="{{ item.slug }}"; plusBtn.dataset.cover="{{ url_for('static', filename='covers/cover.png') }}";
    grid.appendChild(plusBtn);

    const makeInvLabel=name=>"{{ item.title }} – inventár: "+name;

    function syncInvChips(){
      grid.querySelectorAll('.inv-chip').forEach(ch=>{
        const name=ch.dataset.inv||ch.textContent.trim(); const lbl=makeInvLabel(name);
        ch.classList.remove('is-selected');
        if(isInPortfolio(lbl)) ch.classList.add('is-added'); else ch.classList.remove('is-added');
      });
      updatePlusVisibility();
    }
    function updatePlusVisibility(){
      plusBtn.classList.toggle('show', grid.querySelectorAll('.inv-chip.is-selected:not(.is-added)').length>0);
    }

    grid.querySelectorAll('.inv-chip').forEach(ch=>{
      ch.addEventListener('click', ()=>{
        const name=ch.dataset.inv||ch.textContent.trim(); const lbl=makeInvLabel(name);
        if(ch.classList.contains('is-added')){
          removeFromPortfolio(lbl); ch.classList.remove('is-added','is-selected');
          showToastRemove({label:lbl, logo:CLUB_LOGO_URL, linkHref:'/portfolio'}); updatePlusVisibility(); return;
        }
        ch.classList.toggle('is-selected'); updatePlusVisibility();
      });
    });

    plusBtn.addEventListener('click', ()=>{
      const selected=[...grid.querySelectorAll('.inv-chip.is-selected:not(.is-added)')];
      if(!selected.length) return;
      selected.forEach(ch=>{
        const name=ch.dataset.inv||ch.textContent.trim(); const lbl=makeInvLabel(name);
        addToPortfolio({kind:plusBtn.dataset.kind, slug:plusBtn.dataset.slug, label:lbl, price_from:0, cover:plusBtn.dataset.cover});
        ch.classList.remove('is-selected'); ch.classList.add('is-added');
      });
      if(selected.length===1){
        const name=selected[0].dataset.inv||selected[0].textContent.trim();
        showToastAdd({label:makeInvLabel(name), logo:CLUB_LOGO_URL, linkHref:'/portfolio'});
      }else{
        showToastAdd({label:`Inventár – pridané ${selected.length} položky`, logo:CLUB_LOGO_URL, linkHref:'/portfolio'});
      }
      updatePlusVisibility();
    });

    window.syncInvChips=syncInvChips; syncInvChips();
  })();

  /* Toggle "Všetky zápasy" */
  (function(){
    const btn = document.getElementById('allToggle');
    const wrap = document.getElementById('allEvents');
    if(!btn || !wrap) return;
    btn.addEventListener('click', ()=>{
      const wasHidden = wrap.classList.contains('d-none');
      wrap.classList.toggle('d-none');
      btn.innerHTML = wasHidden ? '<i class="bi bi-list-ul"></i> Skryť všetky zápasy'
                                : '<i class="bi bi-list-ul"></i> Všetky zápasy';
      if(!wasHidden) window.scrollTo({ top:btn.getBoundingClientRect().top + window.scrollY - 96, behavior:'smooth' });
    });
  })();

  /* Audience % label placement for narrow bars */
  (function(){
    function adjust(){
      document.querySelectorAll('.ld-age-fill').forEach(fill=>{
        fill.classList.remove('tiny');
        const w = parseFloat(getComputedStyle(fill).width);
        const parentW = parseFloat(getComputedStyle(fill.parentElement).width);
        if(parentW && (w/parentW) < 0.22){ fill.classList.add('tiny'); }
      });
    }
    adjust(); window.addEventListener('resize', adjust);
  })();

  /* ====== Combine Offer modal (zjednodušené: iba výber položiek) ====== */
  (function(){
    const openBtn = document.getElementById('openCombo');
    const modal   = document.getElementById('comboModal');
    if(!openBtn || !modal) return;

    const sumEl  = modal.querySelector('.cmb-sum');
    const addBtn = document.getElementById('cmbAdd');

    function open(){
      modal.classList.add('is-open');
      document.body.style.overflow='hidden';
      // reset výber pri každom otvorení
      modal.querySelectorAll('.cmb-row').forEach(row=>{
        row.classList.remove('is-picked');
        const p=row.querySelector('.pick-btn'); if(p){ p.setAttribute('aria-pressed','false'); p.innerHTML='<i class="bi bi-plus-lg"></i>'; }
      });
      recalc();
    }
    function close(){ modal.classList.remove('is-open'); document.body.style.overflow=''; }

    openBtn.addEventListener('click', open);
    modal.querySelector('.sp-modal__backdrop').addEventListener('click', close);
    modal.querySelector('.sp-modal__close').addEventListener('click', close);
    document.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });

    function fmtEUR(n){ return '€' + Number(n||0).toLocaleString('sk-SK', {maximumFractionDigits:0}); }

    function parsePrice(v){
      const s = String(v ?? '').replace(/\s/g,'').replace(/[^\d.,-]/g,'');
      if(!s) return 0;
      let t=s;
      if(t.includes('.') && t.includes(',')) t=t.replace(/\./g,'').replace(',', '.');
      else if(t.includes(',')) t=t.replace(',', '.');
      const n=parseFloat(t); return isNaN(n)?0:n;
    }
    function getRowPrice(row){
      const fromData = row.dataset.price;
      if (fromData && fromData !== '0') return parsePrice(fromData);
      const fromText = row.querySelector('.cmb-price')?.textContent || '0';
      return parsePrice(fromText);
    }

    // Inicializácia riadkov: formát ceny + klik na +
    modal.querySelectorAll('.cmb-row').forEach(row=>{
      row._price = getRowPrice(row);
      const priceEl = row.querySelector('.cmb-price');
      if(priceEl) priceEl.textContent = fmtEUR(row._price);

      const pick = row.querySelector('.pick-btn');
      if(pick){
        pick.addEventListener('click', (e)=>{
          e.stopPropagation();
          const picked = !row.classList.contains('is-picked');
          row.classList.toggle('is-picked', picked);
          pick.setAttribute('aria-pressed', picked ? 'true':'false');
          pick.innerHTML = picked ? '<i class="bi bi-check-lg"></i>' : '<i class="bi bi-plus-lg"></i>';
          recalc();
        });
      }

      // celá lišta je klikateľná (okrem samotného pick tlačidla – to riešime vyššie)
      row.addEventListener('click', (e)=>{
        if(e.target.closest('.pick-btn')) return;
        const picked = !row.classList.contains('is-picked');
        row.classList.toggle('is-picked', picked);
        const pickBtn=row.querySelector('.pick-btn');
        if(pickBtn){
          pickBtn.setAttribute('aria-pressed', picked ? 'true':'false');
          pickBtn.innerHTML = picked ? '<i class="bi bi-check-lg"></i>' : '<i class="bi bi-plus-lg"></i>';
        }
        recalc();
      });
    });

    function recalc(){
      let total = 0;
      const pickedParts = [];

      modal.querySelectorAll('.cmb-row.is-picked').forEach(row=>{
        total += row._price || 0;
        pickedParts.push(row.dataset.name || '');
      });

      sumEl.textContent = fmtEUR(total);

      if(total <= 0){
        addBtn.disabled = true;
        addBtn.dataset.label = '';
        addBtn.dataset.price = '';
        addBtn.classList.remove('btn-added');
        addBtn.innerHTML = '<i class="bi bi-plus-circle"></i> Pridať do portfólia';
        addBtn.dataset.addedLabel = '';
        return;
      }

      addBtn.disabled = false;
      const label = "{{ item.title }} – Kombinovaný balík (" + pickedParts.join(', ') + ")";
      addBtn.dataset.label = label;
      addBtn.dataset.price = fmtEUR(total);

      if (addBtn.dataset.addedLabel === label){
        addBtn.classList.add('btn-added');
        addBtn.innerHTML = '<i class="bi bi-check2-circle"></i> Pridané';
      } else {
        addBtn.classList.remove('btn-added');
        addBtn.innerHTML = '<i class="bi bi-plus-circle"></i> Pridať do portfólia';
      }
    }

    // CTA klik – až tu sa mení na „Pridané“
    addBtn.addEventListener('click', ()=>{
      if(addBtn.disabled) return;
      const label = addBtn.dataset.label || '';
      if(!label) return;

      const payload = {
        kind: addBtn.dataset.kind,
        slug: addBtn.dataset.slug,
        label,
        price_from: parsePrice(addBtn.dataset.price || '0'),
        cover: addBtn.dataset.cover
      };

      if (isInPortfolio(label)) {
        removeFromPortfolio(label);
        addBtn.dataset.addedLabel = '';
        addBtn.classList.remove('btn-added');
        addBtn.innerHTML = '<i class="bi bi-plus-circle"></i> Pridať do portfólia';
        showToastRemove({label, logo:CLUB_LOGO_URL, linkHref:'/portfolio'});
      } else {
        addToPortfolio(payload);
        addBtn.dataset.addedLabel = label;
        addBtn.classList.add('btn-added');
        addBtn.innerHTML = '<i class="bi bi-check2-circle"></i> Pridané';
        showToastAdd({label, price:addBtn.dataset.price, logo:CLUB_LOGO_URL, linkHref:'/portfolio'});
      }
    });
  })();

/* Move social icons under Prehľad (mobile only) */
(function(){
  const MOBILE_W = 576;
  const seg = document.querySelector('.ld-hero .ld-seg');   // current socials
  const overview = document.getElementById('overview');
  if(!seg || !overview) return;

  // We'll insert socials right before the "Významné úspechy" header row.
  const achToggle = overview.querySelector('#achToggle');
  const anchorRow = achToggle ? achToggle.closest('div') : overview.lastElementChild;

  // Create a slot inside #overview where socials will live on mobile
  const slot = document.createElement('div');
  slot.className = 'ld-overview-social';

  // Remember original place to restore on desktop
  const home = { parent: seg.parentNode, next: seg.nextSibling };

  function toMobile(){
    if (window.innerWidth <= MOBILE_W && seg.parentNode !== slot){
      // ensure slot is inserted before achievements section
      if (!slot.parentNode) overview.insertBefore(slot, anchorRow);
      slot.appendChild(seg);
    }
  }
  function toDesktop(){
    if (window.innerWidth > MOBILE_W && seg.parentNode !== home.parent){
      home.parent.insertBefore(seg, home.next);
      slot.remove(); // clean up the temporary slot
    }
  }
  function handle(){
    if (window.innerWidth <= MOBILE_W) toMobile(); else toDesktop();
  }

  handle();
  window.addEventListener('resize', handle);
})();

  /* Initial sync */
  syncAllAddButtons();
  if(window.syncInvChips){ window.syncInvChips(); }


</script>

{% endblock %}
